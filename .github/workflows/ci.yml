name: CI

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
      MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
      SECRET_KEY: ${{ secrets.SECRET_KEY }}
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install system deps (tesseract)
        run: sudo apt-get update && sudo apt-get install -y tesseract-ocr
      - name: Install Python deps
        run: pip install -r carecloud/requirements.txt
      - name: Run smoke checks
        run: |
          python - <<'PY'
          import os, sys
          print("ENV VARS:")
          print("GEMINI_API_KEY set:", bool(os.getenv("GEMINI_API_KEY")))
          print("MAIL_USERNAME set:", bool(os.getenv("MAIL_USERNAME")))
          print("MAIL_PASSWORD set:", bool(os.getenv("MAIL_PASSWORD")))
          print("SECRET_KEY set:", bool(os.getenv("SECRET_KEY")))
          # Basic import checks
          try:
              import flask, sqlalchemy, PIL, pytesseract, google
              print("Core imports OK")
          except Exception as e:
              print("Import error:", e)
              sys.exit(1)
          print("Smoke checks passed")
          PY
