{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="agent-container">

  <!-- HEADER -->
  <div class="agent-status-header">
    <div class="status-left">
      <div class="agent-indicator active"></div>
      <div>
        <h1>CareCloud Safety Agent</h1>
        <p class="status-label">Protecting you in real time</p>
      </div>
    </div>
    <div class="user-info">
      <span class="user-name">
        {{ user.name if user is defined and user.name else 'User' }}
      </span>
    </div>
  </div>

  <div class="dashboard-layout">

    <!-- LEFT PANEL -->
    <div class="action-card">

      <!-- TOXICITY GAUGE -->
      <div class="meter-container">
        <div class="gauge-wrapper">
          <div class="gauge-background"></div>
          <div class="gauge-needle" id="gaugeNeedle"></div>
          <div class="gauge-center"></div>
        </div>
        <div class="gauge-labels">
          <span>Safe</span>
          <span>Moderate</span>
          <span>High Risk</span>
        </div>
      </div>

      <h2>Analyze Content</h2>
      <p class="card-subtitle">
        Paste any message or upload a screenshot. CareCloud will protect you.
      </p>

      <!-- FORM -->
      <form id="analyzeForm" enctype="multipart/form-data">

        <div class="input-group">
          <label>Text / Message</label>
          <textarea
            id="text_content"
            name="text"
            placeholder="Paste messages, comments, or anything that feels uncomfortableâ€¦"
            rows="5"
          ></textarea>
        </div>

        <div class="input-group">
          <label>Screenshot (optional)</label>
          <input
            type="file"
            id="image_file"
            name="image"
            accept="image/*"
            class="input-file"
          >
        </div>

        <button
          type="submit"
          id="analyzeBtn"
          class="btn-analyze"
        >
          Analyze Now
        </button>
      </form>

      <!-- STATES -->
      <div id="stateContainer">
        <div id="analyzingState" style="display:none">
          <div class="agent-spinner"></div>
          <p>Analyzing safelyâ€¦</p>
        </div>

        <div id="safeState" class="safe-state" style="display:none">
          âœ… Content appears safe
        </div>

        <div id="riskState" class="risk-state" style="display:none">
          âš  Potential harm detected
        </div>
      </div>

      <!-- POSITIVE TIPS SECTION (ALWAYS VISIBLE) -->
      <div class="tips-section">
        <h3>ğŸ’¡ Positive Vibes</h3>
        <div class="tips-grid">
          <div class="tip-card">
            <span class="tip-icon">âœ¨</span>
            <p>You are not alone.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon">ğŸ’ª</span>
            <p>Asking for help is strong.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon">ğŸ›¡</span>
            <p>You have power to block.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon">â¤ï¸</span>
            <p>Mean words â‰  Your worth.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon">ğŸ§˜</span>
            <p>Take a social media break.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon">ğŸ¤</span>
            <p>Find positive friends.</p>
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT PANEL -->
    <div class="results-panel">

      <div id="resultsEmpty" class="results-empty">
        <p>Your analysis results will appear here</p>
      </div>

      <div id="resultsContent" class="results-content">

        <!-- SCORE -->
        <div class="risk-section">
          <div class="risk-meter">
            <div class="risk-bar" id="riskBar"></div>
          </div>
          <div class="risk-labels">
            <span class="risk-value" id="riskScore">0%</span>
            <span class="risk-status" id="riskStatus">Safe</span>
          </div>
        </div>

        <!-- LABELS -->
        <div class="detections-section">
          <h3>What was detected</h3>
          <div id="labelsContainer" class="labels-minimal"></div>
        </div>

        <!-- EXPLANATION -->
        <div class="analysis-summary">
          <h3>Why this content may be harmful</h3>
          <p id="explanationText">â€”</p>
        </div>

        <!-- SUPPORT -->
        <div id="victimSupportSection" class="victim-support-section">
          <h3>ğŸ’™ Support for You</h3>
          <p id="victimSupportText">â€”</p>
        </div>

        <!-- STEPS -->
        <div id="safeResponsesSection" class="safe-responses-section">
          <h3>What you can do now</h3>
          <ul id="safeResponsesList"></ul>
        </div>

        <!-- ALERT -->
        <div id="alertInfo" class="alert-notification">
          âš  A parent or guardian has been notified for safety
        </div>
      </div>

      <!-- HISTORY -->
      <div class="agent-insights">
        <h4>Recent Insights</h4>
        <ul id="historyList" class="history-list">
          <!-- JS populates this -->
        </ul>
        <p id="noHistoryMsg" class="text-muted">No previous analysis</p>
      </div>

    </div>
  </div>

  <!-- REASON MODAL -->
  <div id="reasonModal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Why was this flagged?</h3>
      <p id="modalExplanationText"></p>
      <div class="modal-support-box">
        <h4>Guidance</h4>
        <p id="modalSupportText"></p>
      </div>
    </div>
  </div>

  <!-- SUPPORT PANEL -->
  <div class="support-panel">
    <h3>ğŸ›¡ Safety Reminder</h3>
    <p>
      You deserve to feel safe online. If something feels wrong,
      trust your instincts and reach out for help.
    </p>

    <div class="support-columns">
      <div>
        <h4>For Students</h4>
        <p>
          Checking this message was a strong choice.
          You can mute, block, report, or take a break.
        </p>
      </div>
      <div>
        <h4>For Parents</h4>
        <p>
          These insights help start calm, supportive conversations â€”
          not punishment.
        </p>
      </div>
    </div>
  </div>

</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
